<!DOCTYPE html>
<html>
  <head>
    <script type='text/javascript' src='javascript/piece.js'></script>
    <script type='text/javascript' src='javascript/board.js'></script>
    <script type='text/javascript' src='javascript/pgn_reader.js'></script>
  </head>
  <body>
    <div style='float: left;'>
      <canvas id='board'>
      </canvas>
      <div id='info'>
        <table>
          <tr>
            <td style='font-weight: bold;'>Event</td>
            <td id='event_name'></td>
          </tr>
          <tr>
            <td style='font-weight: bold;'>White</td>
            <td id='white_player'></td>
          </tr>
          <tr>
            <td style='font-weight: bold;'>Black</td>
            <td id='black_player'></td>
          </tr>
        </table>
      </div>
    </div>

    <p>Input PGN Text:</p>
    <textarea id='pgn' style='width: 400px; height: 150px;'></textarea>
    <button name='parsePGN' onclick='parsePGN()'>Parse PGN</button>
    <button name='advance' onclick='advancePGN()'>&gt;&gt;</button>





    <script type="text/javascript" charset="utf-8">
      board                = chessBoard().init('board');
      board.light_square   = 'tan';
      board.dark_square    = 'olive';
      board.square_width   = '100';
      board.draw();
      board.set();

      reader = pgnReader().init(board);

      function parsePGN(){
        pgn = document.getElementById('pgn').value
        reader.parse(pgn);
        document.getElementById('event_name').innerHTML = reader.event;
        document.getElementById('white_player').innerHTML = reader.white;
        document.getElementById('black_player').innerHTML = reader.black;
      }

      move_idx = 0;
      turn = 'white';
      function advancePGN(){
        movetext = reader.moves.shift();
        if(movetext){
          console.log(movetext + ' ' + turn);
          moves = reader.decodePGN(movetext, turn);
          if(moves == true)  return true;
          moves.forEach(function(move){
            board.movePiece(move.start, move.destination, move.is_capture, move.promote_to);
          });
        }
        turn = turn == 'white'  ? 'black' : 'white'
      }




    </script>
  </body>
</html>
