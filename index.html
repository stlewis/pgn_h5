<!DOCTYPE html>
<html>
  <head>
    <script type='text/javascript' src='javascript/piece.js'></script>
    <script type='text/javascript' src='javascript/board.js'></script>
    <script type='text/javascript' src='javascript/pgn_reader.js'></script>
  </head>
  <body>
    <div style='float: left;'>
      <canvas id='board'>
      </canvas>
      <div id='info'>
        <table>
          <tr>
            <td style='font-weight: bold;'>Event</td>
            <td id='event_name'></td>
          </tr>
          <tr>
            <td style='font-weight: bold;'>White</td>
            <td id='white_player'></td>
          </tr>
          <tr>
            <td style='font-weight: bold;'>Black</td>
            <td id='black_player'></td>
          </tr>
        </table>
      </div>
    </div>

    <p>Input PGN Text:</p>
    <textarea id='pgn' style='width: 400px; height: 150px;'>
[Event "Hoogovens A Tournament"]
[Site "Wijk aan Zee NED"]
[Date "1999.01.20"]
[EventDate "?"]
[Round "4"]
[Result "1-0"]
[White "Garry Kasparov"]
[Black "Veselin Topalov"]
[ECO "B06"]
[WhiteElo "2812"]
[BlackElo "2700"]
[PlyCount "87"]

1. e4 d6 2. d4 Nf6 3. Nc3 g6 4. Be3 Bg7 5. Qd2 c6 6. f3 b5
7. Nge2 Nbd7 8. Bh6 Bxh6 9. Qxh6 Bb7 10. a3 e5 11. O-O-O Qe7
12. Kb1 a6 13. Nc1 O-O-O 14. Nb3 exd4 15. Rxd4 c5 16. Rd1 Nb6
17. g3 Kb8 18. Na5 Ba8 19. Bh3 d5 20. Qf4+ Ka7 21. Rhe1 d4
22. Nd5 Nbxd5 23. exd5 Qd6 24. Rxd4 cxd4 25. Re7+ Kb6
26. Qxd4+ Kxa5 27. b4+ Ka4 28. Qc3 Qxd5 29. Ra7 Bb7 30. Rxb7
Qc4 31. Qxf6 Kxa3 32. Qxa6+ Kxb4 33. c3+ Kxc3 34. Qa1+ Kd2
35. Qb2+ Kd1 36. Bf1 Rd2 37. Rd7 Rxd7 38. Bxc4 bxc4 39. Qxh8
Rd3 40. Qa8 c3 41. Qa4+ Ke1 42. f4 f5 43. Kc1 Rd2 44. Qa7 1-0
    </textarea>
    <button name='parsePGN' onclick='parsePGN()'>Parse PGN</button>
    <button name='advance' onclick='advancePGN()'>&gt;&gt;</button>





    <script type="text/javascript" charset="utf-8">
      board                = chessBoard().init('board');
      board.light_square   = 'tan';
      board.dark_square    = 'olive';
      board.square_width   = '40';
      board.draw();
      board.set();

      reader = pgnReader().init(board);

      function parsePGN(){
        pgn = document.getElementById('pgn').value
        reader.parse(pgn);
        document.getElementById('event_name').innerHTML = reader.event;
        document.getElementById('white_player').innerHTML = reader.white;
        document.getElementById('black_player').innerHTML = reader.black;
      }

      move_idx = 0;
      turn = 'white';
      function advancePGN(){
        movetext = reader.moves.shift();
        if(movetext){
          moves = reader.decodePGN(movetext, turn);
          moves.forEach(function(move){
            board.movePiece(move.start, move.destination, move.is_capture, move.promote_to);
          });
        }
        turn = turn == 'white'  ? 'black' : 'white'
      }




    </script>
  </body>
</html>
