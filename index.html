<!DOCTYPE html>
<html>
  <head>
    <script type='text/javascript' src='javascript/piece.js'></script>
    <script type='text/javascript' src='javascript/board.js'></script>
    <script type='text/javascript' src='javascript/pgn_reader.js'></script>
  </head>
  <body>
    <div style='float: left;'>
      <canvas id='board'>
      </canvas>
      <div id='info'>
        <table>
          <tr>
            <td style='font-weight: bold;'>Event</td>
            <td id='event_name'></td>
          </tr>
          <tr>
            <td style='font-weight: bold;'>White</td>
            <td id='white_player'></td>
          </tr>
          <tr>
            <td style='font-weight: bold;'>Black</td>
            <td id='black_player'></td>
          </tr>
        </table>
      </div>
    </div>

    <p>Input PGN Text:</p>
    <textarea id='pgn' style='width: 400px; height: 150px;'>
[Event "Casual Game"]
[Site "Huntington Beach, United States"]
[Date "2015.01.26"]
[Round "-"]
[White "Lewis, Steve"]
[Black "Apple Chess 3.10"]
[Result "1-0"]
[Time "15:32:14"]
[BlackType: "program"]

1. e4 e6 {Your basic pawn opening} 2. Nf3 {White plays on the idea that you want to develop your knights first.}
2...c5 3. Bc4 Nc6 4. O-O Nf6 5. Nc3 d6
6. d4 cxd4 7. Nxd4 Nxd4 8. Qxd4 Bd7 9. Bg5 Be7 10. Rad1 O-O 
11. Rfe1 Qc7 12. e5 d5 13. Bb3 Rfc8 14. Rd3 Qa5 15. exf6 Bf8 
16. fxg7 Bxg7 17. Qh4 Bxc3 18. bxc3 Rc5 19. Ra1 Rac8 20. c4 Rxc4 
21. Bxc4 Rxc4 22. Qh5 Rxc2 23. Rh3 Kh8 24. Qxh7 
1-0
    </textarea>
    <button name='parsePGN' onclick='parsePGN()'>Parse PGN</button>
    <button name='advance' onclick='advancePGN()'>&gt;&gt;</button>
    <h2>Comments</h2>
    <textarea id='movecomment' style='height: 200px; width: 400px;' readonly='true'></textarea>





    <script type="text/javascript" charset="utf-8">
      board                = chessBoard().init('board');
      board.light_square   = 'tan';
      board.dark_square    = 'olive';
      board.square_width   = '40';
      board.draw();
      board.set();

      reader = pgnReader().init(board);

      function parsePGN(){
        pgn = document.getElementById('pgn').value
        reader.parse(pgn);
        document.getElementById('event_name').innerHTML = reader.event;
        document.getElementById('white_player').innerHTML = reader.white;
        document.getElementById('black_player').innerHTML = reader.black;
      }

      turn = 'white';
      function advancePGN(){
        var current_ply  = reader.plys.shift();
        if(!current_ply) return true;
        var movetext     = current_ply.movetext;
        var current_move = reader.moves[current_ply.moveindex];

        if(current_move.comment){
          document.getElementById('movecomment').value = current_move.comment;
        }else{
          document.getElementById('movecomment').value = '';
        }

        if(movetext){
          console.log(current_move);
          console.log(movetext + ' ' + turn);
          moves = reader.decodePGN(movetext, turn);
          if(moves == true)  return true;
          moves.forEach(function(move){
            board.movePiece(move.start, move.destination, move.is_capture, move.promote_to);
          });
        }
        turn = turn == 'white'  ? 'black' : 'white'
      }

    </script>
  </body>
</html>
