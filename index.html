<!DOCTYPE html>
<html>
  <head>
    <script type='text/javascript' src='javascript/board.js'></script>
    <script type='text/javascript' src='javascript/pgn_reader.js'></script>
  </head>
  <body>
    <canvas id='board'>
    </canvas>
    <script type="text/javascript" charset="utf-8">
      board = chessBoard();
      board.light_square = 'red';
      board.dark_square  = '#666';
      board.square_width = '50';
      board.init('board');
      board.draw();
      board.set();
      reader = pgnReader();
      reader.init(board);
    </script>
    <br />
    <textarea id='pgn' style='width: 400px; height: 200px;'></textarea><br />
    <button id='submit_pgn' onclick='parsePGN()'>Start Replay</button>

    <script>
      function parsePGN(){
        raw    = document.getElementById('pgn').value
        reader.parse(raw);

        is_white = true; 
        
        reader.moves.forEach(function(move, idx){
          
          setInterval(function(){
            color = is_white ? 'white' : 'black';
            move  = reader.decodePGN(move, color)[0];
            board.movePiece(move.start, move.destination, move.is_capture, move.promoting_piece);
            is_white = !is_white;
          }, 3000);

        
        });


      }
    </script>



  </body>
</html>
